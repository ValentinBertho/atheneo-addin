<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATHENEO - Contacts</title>
    <script src="https://res.cdn.office.net/teams-js/2.19.0/js/MicrosoftTeams.min.js" crossorigin="anonymous"></script>
    <script src="../config.js"></script>
    <link rel="stylesheet" href="../assets/common-styles.css">
</head>
<body>
    <div class="container">
        <!-- Header avec recherche -->
        <div class="page-header">
            <div class="header-top">
                <h1>üë• Gestion des Contacts</h1>
                <button class="btn btn-primary" onclick="openNewContactModal()">
                    <span>‚ûï</span> Nouveau contact
                </button>
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="üîç Rechercher par nom, email ou soci√©t√©..." oninput="searchContacts()">
                <button class="btn btn-secondary" onclick="toggleFilters()">
                    <span>üîΩ</span> Filtres
                </button>
            </div>
            <div class="filters" id="filters" style="display: none;">
                <select id="filterType" onchange="applyFilters()">
                    <option value="">Tous les types</option>
                    <option value="client">Client</option>
                    <option value="prospect">Prospect</option>
                    <option value="partenaire">Partenaire</option>
                    <option value="fournisseur">Fournisseur</option>
                </select>
                <select id="filterStatus" onchange="applyFilters()">
                    <option value="">Tous les statuts</option>
                    <option value="actif">Actif</option>
                    <option value="inactif">Inactif</option>
                </select>
                <button class="btn btn-sm" onclick="resetFilters()">R√©initialiser</button>
            </div>
        </div>

        <!-- Liste des contacts -->
        <div class="contacts-grid" id="contactsList">
            <!-- Les contacts seront charg√©s ici -->
        </div>

        <!-- Modal nouveau contact -->
        <div class="modal" id="contactModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">‚ûï Nouveau contact</h2>
                    <button class="btn-close" onclick="closeContactModal()">‚úï</button>
                </div>
                <form id="contactForm" onsubmit="saveContact(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nom *</label>
                            <input type="text" id="nom" required>
                        </div>
                        <div class="form-group">
                            <label>Pr√©nom *</label>
                            <input type="text" id="prenom" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label>T√©l√©phone</label>
                            <input type="tel" id="telephone">
                        </div>
                        <div class="form-group">
                            <label>Fonction</label>
                            <input type="text" id="fonction">
                        </div>
                        <div class="form-group">
                            <label>Soci√©t√©</label>
                            <input type="text" id="societe">
                        </div>
                        <div class="form-group">
                            <label>Type *</label>
                            <select id="type" required>
                                <option value="client">Client</option>
                                <option value="prospect">Prospect</option>
                                <option value="partenaire">Partenaire</option>
                                <option value="fournisseur">Fournisseur</option>
                                <option value="interne">Interne</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Statut</label>
                            <select id="statut">
                                <option value="actif">Actif</option>
                                <option value="inactif">Inactif</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Adresse</label>
                        <textarea id="adresse" rows="3"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeContactModal()">Annuler</button>
                        <button type="submit" class="btn btn-primary">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let contacts = [];
        let filteredContacts = [];

        microsoftTeams.app.initialize().then(() => {
            loadContacts();
        });

        async function loadContacts() {
            try {
                // Donn√©es mock√©es pour la d√©mo
                contacts = [
                    {id: 1, nom: 'Dupont', prenom: 'Marie', email: 'marie.dupont@techcorp.fr', telephone: '+33 6 12 34 56 78', fonction: 'Directrice Marketing', societe: 'TechCorp', type: 'client', statut: 'actif'},
                    {id: 2, nom: 'Martin', prenom: 'Jean', email: 'j.martin@innovate.com', telephone: '+33 6 98 76 54 32', fonction: 'CEO', societe: 'Innovate SAS', type: 'prospect', statut: 'actif'},
                    {id: 3, nom: 'Bernard', prenom: 'Sophie', email: 'sophie.b@digital.fr', telephone: '+33 6 11 22 33 44', fonction: 'Chef de projet', societe: 'Digital Plus', type: 'client', statut: 'actif'},
                    {id: 4, nom: 'Dubois', prenom: 'Pierre', email: 'pierre.dubois@solutions.net', telephone: '+33 6 55 66 77 88', fonction: 'Responsable commercial', societe: 'Solutions IT', type: 'partenaire', statut: 'actif'},
                    {id: 5, nom: 'Petit', prenom: 'Claire', email: 'c.petit@services.com', telephone: '+33 6 44 33 22 11', fonction: 'Consultante', societe: 'Services Pro', type: 'fournisseur', statut: 'actif'}
                ];
                filteredContacts = [...contacts];
                renderContacts();
            } catch (error) {
                console.error('Error loading contacts:', error);
            }
        }

        function renderContacts() {
            const list = document.getElementById('contactsList');
            if (filteredContacts.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Aucun contact trouv√©</p></div>';
                return;
            }
            list.innerHTML = filteredContacts.map(contact => `
                <div class="contact-card">
                    <div class="contact-avatar">${contact.prenom[0]}${contact.nom[0]}</div>
                    <div class="contact-info">
                        <h3>${contact.prenom} ${contact.nom}</h3>
                        <p class="contact-fonction">${contact.fonction || 'N/A'}</p>
                        <p class="contact-societe">${contact.societe || 'N/A'}</p>
                        <div class="contact-meta">
                            <span class="badge badge-${contact.type}">${contact.type}</span>
                            <span class="badge badge-${contact.statut}">${contact.statut}</span>
                        </div>
                    </div>
                    <div class="contact-actions">
                        <button class="btn-icon" onclick="callContact('${contact.telephone}')" title="Appeler">üìû</button>
                        <button class="btn-icon" onclick="chatContact('${contact.email}')" title="Chat">üí¨</button>
                        <button class="btn-icon" onclick="editContact(${contact.id})" title="√âditer">‚úèÔ∏è</button>
                        <button class="btn-icon" onclick="deleteContact(${contact.id})" title="Supprimer">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function searchContacts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            filteredContacts = contacts.filter(c =>
                c.nom.toLowerCase().includes(query) ||
                c.prenom.toLowerCase().includes(query) ||
                c.email.toLowerCase().includes(query) ||
                (c.societe && c.societe.toLowerCase().includes(query))
            );
            applyFilters();
        }

        function toggleFilters() {
            const filters = document.getElementById('filters');
            filters.style.display = filters.style.display === 'none' ? 'flex' : 'none';
        }

        function applyFilters() {
            const type = document.getElementById('filterType').value;
            const status = document.getElementById('filterStatus').value;

            let result = [...filteredContacts];
            if (type) result = result.filter(c => c.type === type);
            if (status) result = result.filter(c => c.statut === status);

            filteredContacts = result;
            renderContacts();
        }

        function resetFilters() {
            document.getElementById('filterType').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('searchInput').value = '';
            filteredContacts = [...contacts];
            renderContacts();
        }

        function openNewContactModal() {
            document.getElementById('contactModal').classList.add('show');
            document.getElementById('contactForm').reset();
        }

        function closeContactModal() {
            document.getElementById('contactModal').classList.remove('show');
        }

        async function saveContact(event) {
            event.preventDefault();
            const formData = {
                nom: document.getElementById('nom').value,
                prenom: document.getElementById('prenom').value,
                email: document.getElementById('email').value,
                telephone: document.getElementById('telephone').value,
                fonction: document.getElementById('fonction').value,
                societe: document.getElementById('societe').value,
                type: document.getElementById('type').value,
                statut: document.getElementById('statut').value,
                adresse: document.getElementById('adresse').value
            };

            // Simuler l'enregistrement
            const newContact = {...formData, id: contacts.length + 1};
            contacts.push(newContact);
            filteredContacts = [...contacts];
            renderContacts();
            closeContactModal();

            // Notification Teams
            microsoftTeams.app.notifySuccess();
        }

        function editContact(id) {
            const contact = contacts.find(c => c.id === id);
            if (contact) {
                document.getElementById('modalTitle').textContent = '‚úèÔ∏è √âditer le contact';
                Object.keys(contact).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) input.value = contact[key];
                });
                openNewContactModal();
            }
        }

        function deleteContact(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce contact ?')) {
                contacts = contacts.filter(c => c.id !== id);
                filteredContacts = [...contacts];
                renderContacts();
            }
        }

        function callContact(phone) {
            microsoftTeams.call.startCall({ targets: [phone], requestedModalities: ['audio'] });
        }

        function chatContact(email) {
            microsoftTeams.chat.openGroupChat({ users: [email] });
        }
    </script>

    <style>
        .contacts-grid { display: grid; gap: 16px; margin-top: 24px; }
        .contact-card { background: white; border-radius: 12px; padding: 20px; border: 1px solid #e5e7eb; display: flex; gap: 16px; align-items: center; transition: all 0.2s; }
        .contact-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .contact-avatar { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 600; flex-shrink: 0; }
        .contact-info { flex: 1; }
        .contact-info h3 { margin: 0 0 4px 0; font-size: 18px; }
        .contact-fonction { color: #6b7280; margin: 2px 0; font-size: 14px; }
        .contact-societe { color: #9ca3af; margin: 2px 0; font-size: 13px; }
        .contact-meta { display: flex; gap: 8px; margin-top: 8px; }
        .contact-actions { display: flex; gap: 8px; }
        .btn-icon { width: 40px; height: 40px; border: none; background: #f3f4f6; border-radius: 8px; cursor: pointer; font-size: 20px; transition: all 0.2s; }
        .btn-icon:hover { background: #8b5cf6; transform: scale(1.1); }
        .badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .badge-client { background: #dbeafe; color: #1e40af; }
        .badge-prospect { background: #fef3c7; color: #92400e; }
        .badge-partenaire { background: #d1fae5; color: #065f46; }
        .badge-actif { background: #d1fae5; color: #065f46; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 16px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
        .modal-footer { padding: 24px; border-top: 1px solid #e5e7eb; display: flex; gap: 12px; justify-content: flex-end; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 24px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group label { font-weight: 500; font-size: 14px; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px 14px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
        .btn-primary { background: #8b5cf6; color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-secondary { background: #f3f4f6; color: #374151; }
        .page-header { background: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .search-bar { display: flex; gap: 12px; }
        .search-bar input { flex: 1; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; }
        .filters { display: flex; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb; }
    </style>
</body>
</html>
